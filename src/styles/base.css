@import "tailwindcss";
@import "tailwindcss-animated";

@plugin "@tailwindcss/typography";

@custom-variant dark (&:where(.dark, .dark *));

@layer base {
  :root {
    /* s-ui core tokens */
    --background: 255 255 255;
    --foreground: 27 27 27;
    --primary: 64 118 162;
    --primary-foreground: 255 255 255;
    --muted: 233 233 233;
    --muted-foreground: 43 43 43;
    --destructive: 178 45 53;

    /* Portfolio extensions (index page) */
    --accent: 128 85 190;
    --accent-foreground: 255 255 255;
    --card: 255 255 255;
    --card-foreground: 27 27 27;
    --border: 233 233 233;
    --radius: 0.5rem;
  }

  .dark {
    /* s-ui core tokens */
    --background: 27 27 27;
    --foreground: 255 255 255;
    --primary: 114 165 211;
    --primary-foreground: 27 27 27;
    --muted: 43 43 43;
    --muted-foreground: 233 233 233;
    --destructive: 234 96 95;

    /* Portfolio extensions (index page) */
    --accent: 158 120 210;
    --accent-foreground: 27 27 27;
    --card: 43 43 43;
    --card-foreground: 255 255 255;
    --border: 43 43 43;
  }
}

@layer base {
  body {
    @apply bg-background text-foreground;
    position: relative;
  }

  body:has(.background-grain)::before {
    content: "";
    position: fixed;
    top: -20%;
    right: -10%;
    width: 60%;
    height: 60%;
    background: radial-gradient(
      ellipse at center,
      rgb(var(--primary) / 0.06) 0%,
      transparent 70%
    );
    pointer-events: none;
    z-index: 0;
  }

  body:has(.background-grain)::after {
    content: "";
    position: fixed;
    bottom: -10%;
    left: -10%;
    width: 50%;
    height: 50%;
    background: radial-gradient(
      ellipse at center,
      rgb(var(--accent) / 0.04) 0%,
      transparent 70%
    );
    pointer-events: none;
    z-index: 0;
  }

  .prose a {
    @apply hover:!text-primary;
  }
}

@layer components {
  .main-contents h2 {
    @apply text-primary my-4 inline-block text-xl font-bold tracking-tight sm:text-2xl;
  }

  .main-contents section {
    @apply mx-auto max-w-6xl p-4 sm:p-8;
  }

  .background-grain::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.015;
    pointer-events: none;
    z-index: 1;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-repeat: repeat;
    background-size: 256px 256px;
  }

  .timeline-container {
    @apply mt-2 text-xs;
  }

  swiper-container::part(bullet) {
    @apply bg-primary;
  }

  swiper-container::part(bullet-active) {
    @apply bg-primary;
  }
}

/* === Entrance Animations === */

@keyframes bento-reveal {
  from {
    opacity: 0;
    transform: translateY(16px) scale(0.98);
    filter: blur(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
    filter: blur(0);
  }
}

.bento-enter {
  animation: bento-reveal 0.7s cubic-bezier(0.23, 1, 0.32, 1) both;
}

.bento-grid > :nth-child(1) {
  animation-delay: 0ms;
}
.bento-grid > :nth-child(2) {
  animation-delay: 60ms;
}
.bento-grid > :nth-child(3) {
  animation-delay: 120ms;
}
.bento-grid > :nth-child(4) {
  animation-delay: 180ms;
}
.bento-grid > :nth-child(5) {
  animation-delay: 240ms;
}
.bento-grid > :nth-child(6) {
  animation-delay: 300ms;
}
.bento-grid > :nth-child(7) {
  animation-delay: 360ms;
}
.bento-grid > :nth-child(8) {
  animation-delay: 420ms;
}
.bento-grid > :nth-child(9) {
  animation-delay: 480ms;
}

/* Gradient text with subtle animation */
.text-gradient {
  background: linear-gradient(
    135deg,
    rgb(var(--primary)) 0%,
    rgb(var(--accent)) 50%,
    rgb(var(--primary)) 100%
  );
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradient-shift 8s ease-in-out infinite;
}

@keyframes gradient-shift {
  0%,
  100% {
    background-position: 0% center;
  }
  50% {
    background-position: 100% center;
  }
}

/* Refined tile hover effect */
.bento-tile {
  transition:
    transform 0.5s cubic-bezier(0.23, 1, 0.32, 1),
    box-shadow 0.5s cubic-bezier(0.23, 1, 0.32, 1),
    border-color 0.4s ease-out;
}

.bento-tile:hover {
  box-shadow:
    0 4px 24px rgb(var(--primary) / 0.08),
    0 1px 3px rgb(0 0 0 / 0.06);
  border-color: rgb(var(--primary) / 0.25);
}

.dark .bento-tile:hover {
  box-shadow:
    0 4px 32px rgb(var(--primary) / 0.12),
    0 1px 4px rgb(0 0 0 / 0.3);
  border-color: rgb(var(--primary) / 0.35);
}

/* Gradient timeline connector */
.timeline ol {
  border-left: none;
  position: relative;
}

.timeline ol::before {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 1px;
  background: linear-gradient(
    to bottom,
    rgb(var(--primary) / 0.3),
    rgb(var(--accent) / 0.15),
    transparent
  );
}

/* Accessibility: respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .bento-enter {
    animation: none;
    opacity: 1;
  }

  .text-gradient {
    animation: none;
  }

  .bento-tile {
    transition: none;
  }
}

@source "../src/**/*.{astro,html,js,jsx,md,mdx,ts,tsx}";
@source "../../node_modules/@s-hirano-ist/s-ui/dist/**/*.js";

@theme {
  --font-sans: "Noto Sans JP Variable", sans-serif;
  --color-background: rgb(var(--background));
  --color-foreground: rgb(var(--foreground));
  --color-primary: rgb(var(--primary));
  --color-primary-foreground: rgb(var(--primary-foreground));
  --color-primary-grad: rgb(var(--primary) / 0.8);
  --color-muted: rgb(var(--muted));
  --color-muted-foreground: rgb(var(--muted-foreground));
  --color-destructive: rgb(var(--destructive));
  --color-card: rgb(var(--card));
  --color-card-foreground: rgb(var(--card-foreground));
  --color-border: rgb(var(--border));
  --color-accent: rgb(var(--accent));
  --color-accent-foreground: rgb(var(--accent-foreground));
  --radius-lg: var(--radius);
  --radius-md: calc(var(--radius) - 2px);
  --radius-sm: calc(var(--radius) - 4px);
}

/* for rehype autolink headings */

.icon-header-link {
  visibility: hidden;
  font-size: 1rem;
  margin-left: 0.3rem;
}

h2:hover .icon-header-link {
  visibility: visible;
}

h3:hover .icon-header-link {
  visibility: visible;
}

/* Shiki dual theme support */
.astro-code {
  background-color: rgb(var(--muted)) !important;
}

.astro-code,
.astro-code span {
  color: var(--shiki-light) !important;
}

.astro-code span {
  background-color: transparent !important;
}

.dark .astro-code {
  background-color: var(--shiki-dark-bg) !important;
}

.dark .astro-code,
.dark .astro-code span {
  color: var(--shiki-dark) !important;
}

.dark .astro-code span {
  background-color: transparent !important;
}
